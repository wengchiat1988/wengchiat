<html>
	
	<head>
	<select onchange="drawRegionsMap()" id='select1'>
	<option value="world">Worldwide</option>
	<option value="150">Europe</option>
	<option value="142">Asia</option>
	</select>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {
        'packages':['geochart'],
        // Note: you will need to get a mapsApiKey for your project.
        // See: https://developers.google.com/chart/interactive/docs/basic_load_libs#load-settings
        'mapsApiKey': 'AIzaSyD-9tSrke72PouQMnMX-a7eZSW0jkFMBWY'
      });
      google.charts.setOnLoadCallback(drawRegionsMap);
	  var region = 'US';
	  
      function drawRegionsMap() {
        var opts = {sendMethod: 'auto'};
		var query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1gDE-QQETeyQ_gBsbb9CXueuryhYUjK8CbbwSBLnmggY/edit?usp=sharing', opts);
		query.setQuery('select B, sum(I) group by B');
		query.send(handleQueryResponse);
      }
	  
	  function drawCountryMap() {
        var opts = {sendMethod: 'auto'};
		var query = new google.visualization.Query('https://docs.google.com/spreadsheets/d/1ROh9TBJmFCXhBzc5pMniFqYKNIIDHWVfIHvYgUVOy90/edit?usp=sharing', opts);
		if(region=='US')query.setQuery('select E, F');
		if(region=='China')query.setQuery('select K, L');
		if(region=='Italy')query.setQuery('select H, I');
		query.send(handleQueryResponse2);
      }
	  
	  
	  function handleQueryResponse(response) {
	  if (response.isError()) {
		alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
		return;
	  } 
	  var sel = document.getElementById("select1");
	  var x = sel.value;
	  var options = {
		  'width':900,
		  'height':500,
		  colorAxis: {colors: ['yellow','FFE033','FF7A33', 'red','maroon']},
          backgroundColor: '#81d4fa',
          datalessRegionColor: 'white',
          defaultColor: '#f5f5f5',
		  region: x
		}
	  var data = response.getDataTable();
	  var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));
	  function selectHandler() {
		var selectedItem = chart.getSelection()[0];
	    if (selectedItem) {
		  var country = data.getValue(selectedItem.row, 0);
		  if(country == 'US' || country == 'China' || country == 'Italy') {
			region = country;
			drawCountryMap();
		  }
	    }
	  }
	  google.visualization.events.addListener(chart, 'select', selectHandler);
	  
	  chart.draw(data, options);
	  }
	  
	  function handleQueryResponse2(response) {
	  if (response.isError()) {
		alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
		return;
	  } 
	  var x = 'US';
	  if(region == 'China') x = 'CN';
	  if(region == 'Italy') x = 'IT';
	  var options = {
		  'width':900,
		  'height':500,
		  colorAxis: {colors: ['yellow','FFE033','FF7A33', 'red','maroon']},
          backgroundColor: '#81d4fa',
          datalessRegionColor: 'white',
          defaultColor: '#f5f5f5',
		  region: x,
		  resolution: 'provinces' 
		}
	  var data = response.getDataTable();
	  var chart = new google.visualization.GeoChart(document.getElementById('regions_div2'));
	  
	  chart.draw(data, options);
	  }
	  
	  
    </script>
  </head>
  <body>
	<!--Divs that will hold the charts-->
	<div id="chart_div3"></div>
	<table class="colums">
	  <tr>
		<td><div id="regions_div" style="border: 1px solid #ccc"></div></td>
		<td><div id="regions_div2" style="border: 1px solid #ccc"></div></td>
	  </tr>
	</table>
	<div id="chart_div3"></div>

	</body>
</html>